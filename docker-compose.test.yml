services:
  postgres:
    image: postgres:13.3
    environment:
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=test
      - POSTGRES_DB=pdf-generator-test

  pdf-generator-test:
    build: .
    entrypoint: yarn test
    environment:
      - TYPEORM_CONNECTION=postgres
      - TYPEORM_HOST=postgres
      - TYPEORM_USERNAME=test
      - TYPEORM_PASSWORD=test
      - TYPEORM_DATABASE=pdf-generator-test
      - TYPEORM_PORT=5432
      - TYPEORM_ENTITIES=src/entities/**/*.ts
    volumes:
      - ./src:/app/src
      - ./tests:/app/tests
      - ./node_modules:/app/node_modules
    depends_on:
      - postgres

volumes:
  postgres-data:
